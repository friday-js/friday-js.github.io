(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{348:function(_,v,p){"use strict";p.r(v);var e=p(13),t=Object(e.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h2",{attrs:{id:"多表查询"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#多表查询"}},[_._v("#")]),_._v(" 多表查询")]),_._v(" "),v("p",[_._v("* 查询语法：")]),_._v(" "),v("div",{staticClass:"language-mysql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("select\n\t列名列表\nfrom\n\t表名列表\nwhere....\n")])])]),v("p",[_._v("* 准备sql")]),_._v(" "),v("div",{staticClass:"language-mysql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("# 创建部门表\nCREATE TABLE dept(\n\tid INT PRIMARY KEY AUTO_INCREMENT,\n\tNAME VARCHAR(20)\n);\nINSERT INTO dept (NAME) VALUES ('开发部'),('市场部'),('财务部');\n\n# 创建员工表\nCREATE TABLE emp (\n\tid INT PRIMARY KEY AUTO_INCREMENT,\n\tNAME VARCHAR(10),\n\tgender CHAR(1), -- 性别\n\tsalary DOUBLE, -- 工资\n\tjoin_date DATE, -- 入职日期\n\tdept_id INT,\n\tFOREIGN KEY (dept_id) REFERENCES dept(id) -- 外键，关联部门表(部门表的主键)\n);\n\nINSERT INTO emp(NAME,gender,salary,join_date,dept_id) VALUES('孙悟空','男',7200,'2013-02-24',1);\nINSERT INTO emp(NAME,gender,salary,join_date,dept_id) VALUES('猪八戒','男',3600,'2010-12-02',2);\nINSERT INTO emp(NAME,gender,salary,join_date,dept_id) VALUES('唐僧','男',9000,'2008-08-08',2);\nINSERT INTO emp(NAME,gender,salary,join_date,dept_id) VALUES('白骨精','女',5000,'2015-10-07',3);\nINSERT INTO emp(NAME,gender,salary,join_date,dept_id) VALUES('蜘蛛精','女',4500,'2011-03-14',1);\n")])])]),v("p",[_._v("* 笛卡尔积：")]),_._v(" "),v("p",[_._v("​    * 有两个集合A,B .取这两个集合的所有组成情况。")]),_._v(" "),v("p",[_._v("​    * 要完成多表查询，需要消除无用的数据")]),_._v(" "),v("p",[_._v("* 多表查询的分类：")]),_._v(" "),v("p",[_._v("​    \\1. 内连接查询：")]),_._v(" "),v("p",[_._v("​       \\1. 隐式内连接：使用where条件消除无用数据")]),_._v(" "),v("p",[_._v("​           * 例子：")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("div",{staticClass:"language-mysql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("-- 查询所有员工信息和对应的部门信息\nSELECT * FROM emp,dept WHERE emp.`dept_id` = dept.`id`;\n\n-- 查询员工表的名称，性别。部门表的名称\nSELECT emp.name,emp.gender,dept.name FROM emp,dept WHERE emp.`dept_id` = dept.`id`;\n\nSELECT\n\tt1.name, -- 员工表的姓名\n\tt1.gender,-- 员工表的性别\n\tt2.name -- 部门表的名称\nFROM\n\temp t1,\n\tdept t2\nWHERE\n\tt1.`dept_id` = t2.`id`;\n")])])]),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​       \\2. 显式内连接：")]),_._v(" "),v("p",[_._v("​           * 语法： select 字段列表 from 表名1 [inner] join 表名2 on 条件")]),_._v(" "),v("p",[_._v("​           * 例如：")]),_._v(" "),v("div",{staticClass:"language-mysql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("SELECT * FROM emp INNER JOIN dept ON emp.`dept_id` = dept.`id`;   \nSELECT * FROM emp JOIN dept ON emp.`dept_id` = dept.`id`;  \n")])])]),v("p",[_._v("​       \\3. 内连接查询：")]),_._v(" "),v("p",[_._v("​           \\1. 从哪些表中查询数据")]),_._v(" "),v("p",[_._v("​           \\2. 条件是什么")]),_._v(" "),v("p",[_._v("​           \\3. 查询哪些字段")]),_._v(" "),v("p",[_._v("​    \\2. 外链接查询：")]),_._v(" "),v("p",[_._v("​       \\1. 左外连接：")]),_._v(" "),v("p",[_._v("​           * 语法：select 字段列表 from 表1 left [outer] join 表2 on 条件；")]),_._v(" "),v("p",[_._v("​           * 查询的是左表所有数据以及其交集部分。")]),_._v(" "),v("p",[_._v("​           * 例子：")]),_._v(" "),v("p",[_._v("​              -- 查询所有员工信息，如果员工有部门，则查询部门名称，没有部门，则不显示部门名称")]),_._v(" "),v("p",[_._v("​              SELECT    t1.*,t2."),v("code",[_._v("name")]),_._v(" FROM emp t1 LEFT JOIN dept t2 ON t1."),v("code",[_._v("dept_id")]),_._v(" = t2."),v("code",[_._v("id")]),_._v(";")]),_._v(" "),v("p",[_._v("​       \\2. 右外连接：")]),_._v(" "),v("p",[_._v("​           * 语法：select 字段列表 from 表1 right [outer] join 表2 on 条件；")]),_._v(" "),v("p",[_._v("​           * 查询的是右表所有数据以及其交集部分。")]),_._v(" "),v("p",[_._v("​           * 例子：")]),_._v(" "),v("p",[_._v("​              SELECT * FROM dept t2 RIGHT JOIN emp t1 ON t1."),v("code",[_._v("dept_id")]),_._v(" = t2."),v("code",[_._v("id")]),_._v(";")]),_._v(" "),v("p",[_._v("​    \\3. 子查询：")]),_._v(" "),v("p",[_._v("​       * 概念：查询中嵌套查询，称嵌套查询为子查询。")]),_._v(" "),v("p",[_._v("​           -- 查询工资最高的员工信息")]),_._v(" "),v("p",[_._v("​           -- 1 查询最高的工资是多少 9000")]),_._v(" "),v("p",[_._v("​           SELECT MAX(salary) FROM emp;")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 2 查询员工信息，并且工资等于9000的")]),_._v(" "),v("p",[_._v("​           SELECT * FROM emp WHERE emp."),v("code",[_._v("salary")]),_._v(" = 9000;")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 一条sql就完成这个操作。子查询")]),_._v(" "),v("p",[_._v("​           SELECT * FROM emp WHERE emp."),v("code",[_._v("salary")]),_._v(" = (SELECT MAX(salary) FROM emp);")]),_._v(" "),v("p",[_._v("​       * 子查询不同情况")]),_._v(" "),v("p",[_._v("​           \\1. 子查询的结果是单行单列的：")]),_._v(" "),v("p",[_._v("​              * 子查询可以作为条件，使用运算符去判断。 运算符： > >= < <= =")]),_._v(" "),v("p",[_._v("​              *")]),_._v(" "),v("p",[_._v("​              -- 查询员工工资小于平均工资的人")]),_._v(" "),v("p",[_._v("​              SELECT * FROM emp WHERE emp.salary < (SELECT AVG(salary) FROM emp);")]),_._v(" "),v("p",[_._v("​           \\2. 子查询的结果是多行单列的：")]),_._v(" "),v("p",[_._v("​              * 子查询可以作为条件，使用运算符in来判断")]),_._v(" "),v("p",[_._v("​              -- 查询'财务部'和'市场部'所有的员工信息")]),_._v(" "),v("p",[_._v("​              SELECT id FROM dept WHERE NAME = '财务部' OR NAME = '市场部';")]),_._v(" "),v("p",[_._v("​              SELECT * FROM emp WHERE dept_id = 3 OR dept_id = 2;")]),_._v(" "),v("p",[_._v("​              -- 子查询")]),_._v(" "),v("p",[_._v("​              SELECT * FROM emp WHERE dept_id IN (SELECT id FROM dept WHERE NAME = '财务部' OR NAME = '市场部');")]),_._v(" "),v("p",[_._v("​           \\3. 子查询的结果是多行多列的：")]),_._v(" "),v("p",[_._v("​              * 子查询可以作为一张虚拟表参与查询")]),_._v(" "),v("p",[_._v("​              -- 查询员工入职日期是2011-11-11日之后的员工信息和部门信息")]),_._v(" "),v("p",[_._v("​              -- 子查询")]),_._v(" "),v("p",[_._v("​              SELECT * FROM dept t1 ,(SELECT * FROM emp WHERE emp."),v("code",[_._v("join_date")]),_._v(" > '2011-11-11') t2")]),_._v(" "),v("p",[_._v("​              WHERE t1.id = t2.dept_id;")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​              -- 普通内连接")]),_._v(" "),v("p",[_._v("​              SELECT * FROM emp t1,dept t2 WHERE t1."),v("code",[_._v("dept_id")]),_._v(" = t2."),v("code",[_._v("id")]),_._v(" AND t1."),v("code",[_._v("join_date")]),_._v(" > '2011-11-11'")]),_._v(" "),v("p",[_._v("​    * 多表查询练习")]),_._v(" "),v("p",[_._v("​           -- 部门表")]),_._v(" "),v("p",[_._v("​           CREATE TABLE dept (")]),_._v(" "),v("p",[_._v("​               id INT PRIMARY KEY PRIMARY KEY, -- 部门id")]),_._v(" "),v("p",[_._v("​               dname VARCHAR(50), -- 部门名称")]),_._v(" "),v("p",[_._v("​               loc VARCHAR(50) -- 部门所在地")]),_._v(" "),v("p",[_._v("​           );")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 添加4个部门")]),_._v(" "),v("p",[_._v("​           INSERT INTO dept(id,dname,loc) VALUES")]),_._v(" "),v("p",[_._v("​           (10,'教研部','北京'),")]),_._v(" "),v("p",[_._v("​           (20,'学工部','上海'),")]),_._v(" "),v("p",[_._v("​           (30,'销售部','广州'),")]),_._v(" "),v("p",[_._v("​           (40,'财务部','深圳');")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 职务表，职务名称，职务描述")]),_._v(" "),v("p",[_._v("​           CREATE TABLE job (")]),_._v(" "),v("p",[_._v("​               id INT PRIMARY KEY,")]),_._v(" "),v("p",[_._v("​               jname VARCHAR(20),")]),_._v(" "),v("p",[_._v("​               description VARCHAR(50)")]),_._v(" "),v("p",[_._v("​           );")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 添加4个职务")]),_._v(" "),v("p",[_._v("​           INSERT INTO job (id, jname, description) VALUES")]),_._v(" "),v("p",[_._v("​           (1, '董事长', '管理整个公司，接单'),")]),_._v(" "),v("p",[_._v("​           (2, '经理', '管理部门员工'),")]),_._v(" "),v("p",[_._v("​           (3, '销售员', '向客人推销产品'),")]),_._v(" "),v("p",[_._v("​           (4, '文员', '使用办公软件');")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 员工表")]),_._v(" "),v("p",[_._v("​           CREATE TABLE emp (")]),_._v(" "),v("p",[_._v("​               id INT PRIMARY KEY, -- 员工id")]),_._v(" "),v("p",[_._v("​               ename VARCHAR(50), -- 员工姓名")]),_._v(" "),v("p",[_._v("​               job_id INT, -- 职务id")]),_._v(" "),v("p",[_._v("​               mgr INT , -- 上级领导")]),_._v(" "),v("p",[_._v("​               joindate DATE, -- 入职日期")]),_._v(" "),v("p",[_._v("​               salary DECIMAL(7,2), -- 工资")]),_._v(" "),v("p",[_._v("​               bonus DECIMAL(7,2), -- 奖金")]),_._v(" "),v("p",[_._v("​               dept_id INT, -- 所在部门编号")]),_._v(" "),v("p",[_._v("​               CONSTRAINT emp_jobid_ref_job_id_fk FOREIGN KEY (job_id) REFERENCES job (id),")]),_._v(" "),v("p",[_._v("​               CONSTRAINT emp_deptid_ref_dept_id_fk FOREIGN KEY (dept_id) REFERENCES dept (id)")]),_._v(" "),v("p",[_._v("​           );")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 添加员工")]),_._v(" "),v("p",[_._v("​           INSERT INTO emp(id,ename,job_id,mgr,joindate,salary,bonus,dept_id) VALUES")]),_._v(" "),v("p",[_._v("​           (1001,'孙悟空',4,1004,'2000-12-17','8000.00',NULL,20),")]),_._v(" "),v("p",[_._v("​           (1002,'卢俊义',3,1006,'2001-02-20','16000.00','3000.00',30),")]),_._v(" "),v("p",[_._v("​           (1003,'林冲',3,1006,'2001-02-22','12500.00','5000.00',30),")]),_._v(" "),v("p",[_._v("​           (1004,'唐僧',2,1009,'2001-04-02','29750.00',NULL,20),")]),_._v(" "),v("p",[_._v("​           (1005,'李逵',4,1006,'2001-09-28','12500.00','14000.00',30),")]),_._v(" "),v("p",[_._v("​           (1006,'宋江',2,1009,'2001-05-01','28500.00',NULL,30),")]),_._v(" "),v("p",[_._v("​           (1007,'刘备',2,1009,'2001-09-01','24500.00',NULL,10),")]),_._v(" "),v("p",[_._v("​           (1008,'猪八戒',4,1004,'2007-04-19','30000.00',NULL,20),")]),_._v(" "),v("p",[_._v("​           (1009,'罗贯中',1,NULL,'2001-11-17','50000.00',NULL,10),")]),_._v(" "),v("p",[_._v("​           (1010,'吴用',3,1006,'2001-09-08','15000.00','0.00',30),")]),_._v(" "),v("p",[_._v("​           (1011,'沙僧',4,1004,'2007-05-23','11000.00',NULL,20),")]),_._v(" "),v("p",[_._v("​           (1012,'李逵',4,1006,'2001-12-03','9500.00',NULL,30),")]),_._v(" "),v("p",[_._v("​           (1013,'小白龙',4,1004,'2001-12-03','30000.00',NULL,20),")]),_._v(" "),v("p",[_._v("​           (1014,'关羽',4,1007,'2002-01-23','13000.00',NULL,10);")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 工资等级表")]),_._v(" "),v("p",[_._v("​           CREATE TABLE salarygrade (")]),_._v(" "),v("p",[_._v("​            grade INT PRIMARY KEY,  -- 级别")]),_._v(" "),v("p",[_._v("​            losalary INT, -- 最低工资")]),_._v(" "),v("p",[_._v("​            hisalary INT -- 最高工资")]),_._v(" "),v("p",[_._v("​           );")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 添加5个工资等级")]),_._v(" "),v("p",[_._v("​           INSERT INTO salarygrade(grade,losalary,hisalary) VALUES")]),_._v(" "),v("p",[_._v("​           (1,7000,12000),")]),_._v(" "),v("p",[_._v("​           (2,12010,14000),")]),_._v(" "),v("p",[_._v("​           (3,14010,20000),")]),_._v(" "),v("p",[_._v("​           (4,20010,30000),")]),_._v(" "),v("p",[_._v("​           (5,30010,99990);")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 需求：")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 1.查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​              分析：")]),_._v(" "),v("p",[_._v("​                  1.员工编号，员工姓名，工资，需要查询emp表 职务名称，职务描述 需要查询job表")]),_._v(" "),v("p",[_._v("​                  2.查询条件 emp.job_id = job.id")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​           SELECT")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("id")]),_._v(", -- 员工编号")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("ename")]),_._v(", -- 员工姓名")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("salary")]),_._v(",-- 工资")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("jname")]),_._v(", -- 职务名称")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("description")]),_._v(" -- 职务描述")]),_._v(" "),v("p",[_._v("​           FROM")]),_._v(" "),v("p",[_._v("​              emp t1, job t2")]),_._v(" "),v("p",[_._v("​           WHERE")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("job_id")]),_._v(" = t2."),v("code",[_._v("id")]),_._v(";")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 2.查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​              分析：")]),_._v(" "),v("p",[_._v("​                  \\1. 员工编号，员工姓名，工资 emp 职务名称，职务描述 job 部门名称，部门位置 dept")]),_._v(" "),v("p",[_._v("​                  \\2. 条件： emp.job_id = job.id and emp.dept_id = dept.id")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           SELECT")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("id")]),_._v(", -- 员工编号")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("ename")]),_._v(", -- 员工姓名")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("salary")]),_._v(",-- 工资")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("jname")]),_._v(", -- 职务名称")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("description")]),_._v(", -- 职务描述")]),_._v(" "),v("p",[_._v("​              t3."),v("code",[_._v("dname")]),_._v(", -- 部门名称")]),_._v(" "),v("p",[_._v("​              t3."),v("code",[_._v("loc")]),_._v(" -- 部门位置")]),_._v(" "),v("p",[_._v("​           FROM")]),_._v(" "),v("p",[_._v("​              emp t1, job t2,dept t3")]),_._v(" "),v("p",[_._v("​           WHERE")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("job_id")]),_._v(" = t2."),v("code",[_._v("id")]),_._v(" AND t1."),v("code",[_._v("dept_id")]),_._v(" = t3."),v("code",[_._v("id")]),_._v(";")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 3.查询员工姓名，工资，工资等级")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​              分析：")]),_._v(" "),v("p",[_._v("​                  1.员工姓名，工资 emp 工资等级 salarygrade")]),_._v(" "),v("p",[_._v("​                  2.条件 emp.salary >= salarygrade.losalary and emp.salary <= salarygrade.hisalary")]),_._v(" "),v("p",[_._v("​                     emp.salary BETWEEN salarygrade.losalary and salarygrade.hisalary")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​           SELECT")]),_._v(" "),v("p",[_._v("​              t1.ename ,")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("salary")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t2.*")]),_._v(" "),v("p",[_._v("​           FROM emp t1, salarygrade t2")]),_._v(" "),v("p",[_._v("​           WHERE t1."),v("code",[_._v("salary")]),_._v(" BETWEEN t2."),v("code",[_._v("losalary")]),_._v(" AND t2."),v("code",[_._v("hisalary")]),_._v(";")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 4.查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​              分析：")]),_._v(" "),v("p",[_._v("​                  \\1. 员工姓名，工资 emp ， 职务名称，职务描述 job 部门名称，部门位置，dept 工资等级 salarygrade")]),_._v(" "),v("p",[_._v("​                  \\2. 条件： emp.job_id = job.id and emp.dept_id = dept.id and emp.salary BETWEEN salarygrade.losalary and salarygrade.hisalary")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​           SELECT")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("ename")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("salary")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("jname")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("description")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t3."),v("code",[_._v("dname")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t3."),v("code",[_._v("loc")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t4."),v("code",[_._v("grade")])]),_._v(" "),v("p",[_._v("​           FROM")]),_._v(" "),v("p",[_._v("​              emp t1,job t2,dept t3,salarygrade t4")]),_._v(" "),v("p",[_._v("​           WHERE")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("job_id")]),_._v(" = t2."),v("code",[_._v("id")])]),_._v(" "),v("p",[_._v("​              AND t1."),v("code",[_._v("dept_id")]),_._v(" = t3."),v("code",[_._v("id")])]),_._v(" "),v("p",[_._v("​              AND t1."),v("code",[_._v("salary")]),_._v(" BETWEEN t4."),v("code",[_._v("losalary")]),_._v(" AND t4."),v("code",[_._v("hisalary")]),_._v(";")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 5.查询出部门编号、部门名称、部门位置、部门人数")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​              分析：")]),_._v(" "),v("p",[_._v("​                  1.部门编号、部门名称、部门位置 dept 表。 部门人数 emp表")]),_._v(" "),v("p",[_._v("​                  2.使用分组查询。按照emp.dept_id完成分组，查询count(id)")]),_._v(" "),v("p",[_._v("​                  3.使用子查询将第2步的查询结果和dept表进行关联查询")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​           SELECT")]),_._v(" "),v("p",[_._v("​              t1."),v("code",[_._v("id")]),_._v(",t1."),v("code",[_._v("dname")]),_._v(",t1."),v("code",[_._v("loc")]),_._v(" , t2.total")]),_._v(" "),v("p",[_._v("​           FROM")]),_._v(" "),v("p",[_._v("​              dept t1,")]),_._v(" "),v("p",[_._v("​              (SELECT")]),_._v(" "),v("p",[_._v("​                  dept_id,COUNT(id) total")]),_._v(" "),v("p",[_._v("​              FROM")]),_._v(" "),v("p",[_._v("​                  emp")]),_._v(" "),v("p",[_._v("​              GROUP BY dept_id) t2")]),_._v(" "),v("p",[_._v("​           WHERE t1."),v("code",[_._v("id")]),_._v(" = t2.dept_id;")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           -- 6.查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​              分析：")]),_._v(" "),v("p",[_._v("​                  1.姓名 emp， 直接上级的姓名 emp")]),_._v(" "),v("p",[_._v("​                     * emp表的id 和 mgr 是自关联")]),_._v(" "),v("p",[_._v("​                  2.条件 emp.id = emp.mgr")]),_._v(" "),v("p",[_._v("​                  3.查询左表的所有数据，和 交集数据")]),_._v(" "),v("p",[_._v("​                     * 使用左外连接查询")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​           /*")]),_._v(" "),v("p",[_._v("​           select")]),_._v(" "),v("p",[_._v("​              t1.ename,")]),_._v(" "),v("p",[_._v("​              t1.mgr,")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("id")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t2.ename")]),_._v(" "),v("p",[_._v("​           from emp t1, emp t2")]),_._v(" "),v("p",[_._v("​           where t1.mgr = t2."),v("code",[_._v("id")]),_._v(";")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           */")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           SELECT")]),_._v(" "),v("p",[_._v("​              t1.ename,")]),_._v(" "),v("p",[_._v("​              t1.mgr,")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("id")]),_._v(",")]),_._v(" "),v("p",[_._v("​              t2."),v("code",[_._v("ename")])]),_._v(" "),v("p",[_._v("​           FROM emp t1")]),_._v(" "),v("p",[_._v("​           LEFT JOIN emp t2")]),_._v(" "),v("p",[_._v("​           ON t1."),v("code",[_._v("mgr")]),_._v(" = t2."),v("code",[_._v("id")]),_._v(";")]),_._v(" "),v("h2",{attrs:{id:"事务"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[_._v("#")]),_._v(" 事务")]),_._v(" "),v("h3",{attrs:{id:"事务的基本介绍"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#事务的基本介绍"}},[_._v("#")]),_._v(" 事务的基本介绍")]),_._v(" "),v("h4",{attrs:{id:"概念"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[_._v("#")]),_._v(" 概念")]),_._v(" "),v("p",[_._v("如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败。")]),_._v(" "),v("h4",{attrs:{id:"操作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#操作"}},[_._v("#")]),_._v(" 操作")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("开启事务： start transaction;")])]),_._v(" "),v("li",[v("p",[_._v("回滚：rollback;")])]),_._v(" "),v("li",[v("p",[_._v("提交：commit;")])])]),_._v(" "),v("h4",{attrs:{id:"例子"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[_._v("#")]),_._v(" 例子")]),_._v(" "),v("div",{staticClass:"language-mysql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("CREATE TABLE account (\n\tid INT PRIMARY KEY AUTO_INCREMENT,\n\tNAME VARCHAR(10),\n\tbalance DOUBLE\n);\n\n-- 添加数据\nINSERT INTO account (NAME, balance) VALUES ('zhangsan', 1000), ('lisi', 1000);\n\nSELECT * FROM account;\nUPDATE account SET balance = 1000;\n\n-- 张三给李四转账 500 元\n-- 0. 开启事务\nSTART TRANSACTION;\n-- 1. 张三账户 -500\nUPDATE account SET balance = balance - 500 WHERE NAME = 'zhangsan';\n-- 2. 李四账户 +500\n-- 出错了...\nUPDATE account SET balance = balance + 500 WHERE NAME = 'lisi';\n-- 发现执行没有问题，提交事务\nCOMMIT;\n-- 发现出问题了，回滚事务\nROLLBACK;\n")])])]),v("p",[_._v("​")]),_._v(" "),v("h4",{attrs:{id:"mysql数据库中事务默认自动提交"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据库中事务默认自动提交"}},[_._v("#")]),_._v(" MySQL数据库中事务默认自动提交")]),_._v(" "),v("p",[_._v("​       * 事务提交的两种方式：")]),_._v(" "),v("p",[_._v("​           * 自动提交：")]),_._v(" "),v("p",[_._v("​              * mysql就是自动提交的")]),_._v(" "),v("p",[_._v("​              * 一条DML(增删改)语句会自动提交一次事务。")]),_._v(" "),v("p",[_._v("​           * 手动提交：")]),_._v(" "),v("p",[_._v("​              * Oracle 数据库默认是手动提交事务")]),_._v(" "),v("p",[_._v("​              * 需要先开启事务，再提交")]),_._v(" "),v("p",[_._v("​       * 修改事务的默认提交方式：")]),_._v(" "),v("p",[_._v("​           * 查看事务的默认提交方式：SELECT @@autocommit; -- 1 代表自动提交 0 代表手动提交")]),_._v(" "),v("p",[_._v("​           * 修改默认提交方式： set @@autocommit = 0;")]),_._v(" "),v("h3",{attrs:{id:"事务的四大特征"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#事务的四大特征"}},[_._v("#")]),_._v(" 事务的四大特征：")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("原子性：是不可分割的最小操作单位，要么同时成功，要么同时失败。")])]),_._v(" "),v("li",[v("p",[_._v("持久性：当事务提交或回滚后，数据库会持久化的保存数据。")])]),_._v(" "),v("li",[v("p",[_._v("隔离性：多个事务之间。相互独立。")])]),_._v(" "),v("li",[v("p",[_._v("一致性：事务操作前后，数据总量不变")])])]),_._v(" "),v("h3",{attrs:{id:"事务的隔离级别-了解"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#事务的隔离级别-了解"}},[_._v("#")]),_._v(" 事务的隔离级别（了解）")]),_._v(" "),v("p",[_._v("​    * 概念：多个事务之间隔离的，相互独立的。但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题。")]),_._v(" "),v("p",[_._v("​    * 存在问题：")]),_._v(" "),v("p",[_._v("​       \\1. 脏读：一个事务，读取到另一个事务中没有提交的数据")]),_._v(" "),v("p",[_._v("​       \\2. 不可重复读(虚读)：在同一个事务中，两次读取到的数据不一样。")]),_._v(" "),v("p",[_._v("​       \\3. 幻读：一个事务操作(DML)数据表中所有记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改。")]),_._v(" "),v("p",[_._v("​    * 隔离级别：")]),_._v(" "),v("p",[_._v("​       \\1. read uncommitted：读未提交")]),_._v(" "),v("p",[_._v("​           * 产生的问题：脏读、不可重复读、幻读")]),_._v(" "),v("p",[_._v("​       \\2. read committed：读已提交 （Oracle）")]),_._v(" "),v("p",[_._v("​           * 产生的问题：不可重复读、幻读")]),_._v(" "),v("p",[_._v("​       \\3. repeatable read：可重复读 （MySQL默认）")]),_._v(" "),v("p",[_._v("​           * 产生的问题：幻读")]),_._v(" "),v("p",[_._v("​       \\4. serializable：串行化")]),_._v(" "),v("p",[_._v("​           * 可以解决所有的问题")]),_._v(" "),v("p",[_._v("​       * 注意：隔离级别从小到大安全性越来越高，但是效率越来越低")]),_._v(" "),v("p",[_._v("​       * 数据库查询隔离级别：")]),_._v(" "),v("p",[_._v("​           * select @@tx_isolation;")]),_._v(" "),v("p",[_._v("​       * 数据库设置隔离级别：")]),_._v(" "),v("p",[_._v("​           * set global transaction isolation level 级别字符串;")]),_._v(" "),v("p",[_._v("​    * 演示：")]),_._v(" "),v("p",[_._v("​       set global transaction isolation level read uncommitted;")]),_._v(" "),v("p",[_._v("​       start transaction;")]),_._v(" "),v("p",[_._v("​       -- 转账操作")]),_._v(" "),v("p",[_._v("​       update account set balance = balance - 500 where id = 1;")]),_._v(" "),v("p",[_._v("​       update account set balance = balance + 500 where id = 2;")]),_._v(" "),v("h2",{attrs:{id:"dcl"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dcl"}},[_._v("#")]),_._v(" DCL")]),_._v(" "),v("h3",{attrs:{id:"sql分类"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sql分类"}},[_._v("#")]),_._v(" SQL分类")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("DDL：操作数据库和表")])]),_._v(" "),v("li",[v("p",[_._v("DML：增删改表中数据")])]),_._v(" "),v("li",[v("p",[_._v("DQL：查询表中数据")])]),_._v(" "),v("li",[v("p",[_._v("DCL：管理用户，授权")])])]),_._v(" "),v("p",[_._v("* DBA：数据库管理员")]),_._v(" "),v("p",[_._v("* DCL：管理用户，授权")]),_._v(" "),v("p",[_._v("​    \\1. 管理用户")]),_._v(" "),v("p",[_._v("​       \\1. 添加用户：")]),_._v(" "),v("p",[_._v("​           * 语法：CREATE USER '用户名'@'主机名' IDENTIFIED BY '密码';")]),_._v(" "),v("p",[_._v("​       \\2. 删除用户：")]),_._v(" "),v("p",[_._v("​           * 语法：DROP USER '用户名'@'主机名';")]),_._v(" "),v("p",[_._v("​       \\3. 修改用户密码：")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           UPDATE USER SET PASSWORD = PASSWORD('新密码') WHERE USER = '用户名';")]),_._v(" "),v("p",[_._v("​           UPDATE USER SET PASSWORD = PASSWORD('abc') WHERE USER = 'lisi';")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           SET PASSWORD FOR '用户名'@'主机名' = PASSWORD('新密码');")]),_._v(" "),v("p",[_._v("​           SET PASSWORD FOR 'root'@'localhost' = PASSWORD('123');")]),_._v(" "),v("p",[_._v("​           * mysql中忘记了root用户的密码？")]),_._v(" "),v("p",[_._v("​              \\1. cmd -- > net stop mysql 停止mysql服务")]),_._v(" "),v("p",[_._v("​                  * 需要管理员运行该cmd")]),_._v(" "),v("p",[_._v("​              \\2. 使用无验证方式启动mysql服务： mysqld --skip-grant-tables")]),_._v(" "),v("p",[_._v("​              \\3. 打开新的cmd窗口,直接输入mysql命令，敲回车。就可以登录成功")]),_._v(" "),v("p",[_._v("​              \\4. use mysql;")]),_._v(" "),v("p",[_._v("​              \\5. update user set password = password('你的新密码') where user = 'root';")]),_._v(" "),v("p",[_._v("​              \\6. 关闭两个窗口")]),_._v(" "),v("p",[_._v("​              \\7. 打开任务管理器，手动结束mysqld.exe 的进程")]),_._v(" "),v("p",[_._v("​              \\8. 启动mysql服务")]),_._v(" "),v("p",[_._v("​              \\9. 使用新密码登录。")]),_._v(" "),v("p",[_._v("​       \\4. 查询用户：")]),_._v(" "),v("p",[_._v("​           -- 1. 切换到mysql数据库")]),_._v(" "),v("p",[_._v("​           USE myql;")]),_._v(" "),v("p",[_._v("​           -- 2. 查询user表")]),_._v(" "),v("p",[_._v("​           SELECT * FROM USER;")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           * 通配符： % 表示可以在任意主机使用用户登录数据库")]),_._v(" "),v("p",[_._v("​    \\2. 权限管理：")]),_._v(" "),v("p",[_._v("​       \\1. 查询权限：")]),_._v(" "),v("p",[_._v("​           -- 查询权限")]),_._v(" "),v("p",[_._v("​           SHOW GRANTS FOR '用户名'@'主机名';")]),_._v(" "),v("p",[_._v("​           SHOW GRANTS FOR 'lisi'@'%';")]),_._v(" "),v("p",[_._v("​       \\2. 授予权限：")]),_._v(" "),v("p",[_._v("​           -- 授予权限")]),_._v(" "),v("p",[_._v("​           grant 权限列表 on 数据库名.表名 to '用户名'@'主机名';")]),_._v(" "),v("p",[_._v("​           -- 给张三用户授予所有权限，在任意数据库任意表上")]),_._v(" "),v("p",[_._v("​")]),_._v(" "),v("p",[_._v("​           GRANT ALL ON "),v("em",[_._v(".")]),_._v(" TO 'zhangsan'@'localhost';")]),_._v(" "),v("p",[_._v("​       \\3. 撤销权限：")]),_._v(" "),v("p",[_._v("​           -- 撤销权限：")]),_._v(" "),v("p",[_._v("​           revoke 权限列表 on 数据库名.表名 from '用户名'@'主机名';")]),_._v(" "),v("p",[_._v("​           REVOKE UPDATE ON db3."),v("code",[_._v("account")]),_._v(" FROM 'lisi'@'%';")])])}),[],!1,null,null,null);v.default=t.exports}}]);